# Code-Beispiel #

Mit diesem Code-Beispiel kann der dam.Parkservice Webservice per PHP serverseitig aufgerufen werden. Eine PHP-Version > 5.3 wird empfohlen.

## Voraussetzungen ##
Bitte laden Sie die Datei [meinparkenSoapClient.php](http://dam-parkservice-api-client.googlecode.com/files/meinparkenSoapClient.php) aus dem Download-Bereich herunter. Speichern Sie sie im selben Verzeichnis wie die unten angezeigte [minitest.php](http://dam-parkservice-api-client.googlecode.com/files/minitest.php) Datei.

## Code ##
Dieser Code ist unter dem Dateinamen [minitest.php](http://dam-parkservice-api-client.googlecode.com/files/minitest.php) im Download-Bereich verfügbar.

```
<?php
/**
 * Diese Datei testet den Buchungs-Webservice.
 * Im Browser aufrufen.
 * 
 * 28.03.2013, Line5 e.K.
 */

// include the client file generated by phpwsdl
require_once('meinparkenSoapClient.php');

// Disable caching in PHP
ini_set('soap.wsdl_cache_enabled',0);	

// some lazy formatting
echo '<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>';
echo "<style>* {font-family: sans-serif; font-size: 14px; } .ok { color: green; } .er { color: red; } 
h1 { font-size: 1em; padding: 0px; margin: 0px;
		background-color: #ccc;}</style>";

define('OK', '<span class="ok">OK</span>');
define('ER', '<span class="er">ERROR</span>');

// compose the booking request
$m = new BookingRequest();
$m->Language = 'en';
$m->Salutation = 'Herr';
$m->FirstName = 'Max';
$m->LastName = 'Mustermann';
$m->MobilePhone = '03076771840';
$m->Email = 'mail@line5.tv';
$m->NumberPlate = 'B-F 123';
$m->OutFlightTS = date('Y-m-d H:i:s', time() + (60*60*24*2)); // two days ahead
$m->OutFlightNo = 'LH123';
$m->RetFlightTS = date('Y-m-d H:i:s', time() + (60*60*24*4)); // four days ahead
$m->RetFlightNo = 'LH321';
$m->ParkTS = date('Y-m-d H:i:s', time() + (60*60*24*1)); // one day in the ahead
$m->Destination = 'TXL';
$m->NumberOfPassengers = 3;
$m->NumberOfVehicles = 1;
$m->Indoor = false;
$m->AgbChecked = true;
$m->BookingIP = getenv('REMOTE_ADDR');
$m->TestMode = 'TESTMODE_NODB';
$m->Company = 'dam.Parkservice';
$m->Street = 'Schulzendorfer Str. 10';
$m->ZIP = '12529';
$m->City = 'Hintertux (Oder)';
$m->Comment = 'Dies ist eine Testbuchung. Bitte löschen.';
$m->APIKey = 'TESTMODEREQUEST';

echo "Das folgende Objekt wird an den Webservice geschickt:<br />";
echo "<pre>".print_r( $m, TRUE )."</pre>";

// call webservice
$param = Array($m);
$mp = meinparkenSoapClient::_Call('Book', $param);

echo "Folgende Antwort kommt vom Webservice zurück:<br />";
echo "<pre>".print_r($mp, true)."</pre>";

if (!isset($mp->Errors) == true) {
	$fx = OK;
} else {
	$fx = ER;
	print_r($mp->Errors);
}
$bid = $mp->BookingId;
if ($bid >= 1) {
	$fx .= ' '.OK.' (#'.print_r($bid, true).')';
} else {
	$fx.= ' '.ER.': '.print_r($bid, true);
}
echo " $fx<br />";
ob_flush();

echo "<br />Im Testmode wird (im Erfolgsfall) immer die 
Buchungs-Id 1 zurückgegeben, bei mehreren Fahrzeugen mehrmals die 1.";

```